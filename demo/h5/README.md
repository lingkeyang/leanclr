# HTML5 Demo

This directory provides a demonstration of LeanCLR in a browser environment (WebAssembly).

## Quick Start

### 1. Start an HTTP Server

Due to browser security policies, this demo must be accessed through an HTTP server.

**Option 1: Using npx (Recommended)**

```cmd
cd demo/h5
npx serve .
```

**Option 2: Using Python**

```cmd
cd demo/h5
python -m http.server 3000
```

**Option 3: Using Other HTTP Servers**

Set this directory as the site root.

### 2. Access the Page

Open `http://localhost:3000/` in your browser (adjust the port number as needed).

### 3. Run the Demo

1. The page will automatically initialize the WASM module and load assemblies after loading
2. Click the **"Initialize Runtime"** button to initialize the LeanCLR runtime
3. Click the **"Run CoreTests.App::Main"** button to execute the sample code
4. The console will display `Hello, World!`

## Directory Structure

```
demo/h5/
├── index.html              # Demo page
├── lean.js                 # WASM module loader (generated by Emscripten)
├── lean.wasm               # LeanCLR WebAssembly binary
├── mscorlib.dll.bytes      # .NET core library
├── System.dll.bytes        # System assembly
├── System.Core.dll.bytes   # System.Core assembly
└── CoreTests.dll.bytes     # Test assembly
```

## How It Works

This demo demonstrates the complete workflow of running .NET assemblies in the browser:

1. **Load WASM Module** - Initialize the LeanCLR WebAssembly module via `createStartupModule()`
2. **Implement Assembly Loading Callback** - Provide the `load_assembly_file` callback function so the runtime can load .NET assemblies from JavaScript
3. **Pre-load Assemblies** - Download `.dll.bytes` files via `fetch` and cache them
4. **Initialize Runtime** - Call `initialize_runtime` to initialize the CLR
5. **Load and Execute Assembly** - Call `load_assemby` to load the target assembly, then call `invoke_method` to execute the specified method

## Testing Custom Code

### Testing Workflow

1. Open [src/tests/managed/managed.sln](../../src/tests/managed/managed.sln) and modify `App::Main` or other code in the `CoreTests` project
2. Build to generate `CoreTests.dll` (Debug or Release)
3. Rename the output `CoreTests.dll` to `CoreTests.dll.bytes` and copy it to this directory
4. Refresh the page and re-run the demo

### Notes

- LeanCLR covers most of ECMA-335; complex C# code including exceptions and reflection will work as long as OS-specific APIs are not called
- Currently, only `System.Diagnostics.Debugger::Log` is available for logging output; do not use `Console.WriteLine` or `UnityEngine.Debug.Log`

## Browser Compatibility

Supports all modern browsers (Chrome, Firefox, Safari, Edge) with WebAssembly support.
